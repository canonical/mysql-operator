{"uid":"a1be80cb3d1c7e43","name":"test_replicate_data_on_restart","fullName":"tests.integration.high_availability.test_self_healing#test_replicate_data_on_restart","historyId":"14ae0e2558e323fa638b35f38c8869e6","time":{"start":1723772196072,"stop":1723772484075,"duration":288003},"description":"Stop server, write data, start and validate replication.","descriptionHtml":"<p>Stop server, write data, start and validate replication.</p>\n","status":"broken","statusMessage":"KeyError: 'status'","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 433, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 112, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 155, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 108, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 80, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 433, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 112, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 155, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 108, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 80, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 532, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/high_availability/test_self_healing.py\", line 252, in test_replicate_data_on_restart\n    new_primary_unit = await get_primary_unit_wrapper(\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/helpers.py\", line 492, in get_primary_unit_wrapper\n    primary_unit = await get_primary_unit(ops_test, unit, app_name)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 88, in async_wrapped\n    return await fn(*args, **kwargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 47, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 325, in iter\n    raise retry_exc.reraise()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 158, in reraise\n    raise self.last_attempt.result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 50, in __call__\n    result = await fn(*args, **kwargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/helpers.py\", line 125, in get_primary_unit\n    for k, v in results[\"status\"][\"defaultreplicaset\"][\"topology\"].items():\nKeyError: 'status'","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"event_loop","time":{"start":1723771808687,"stop":1723771808688,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1723771808688,"stop":1723771808688,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1723771808688,"stop":1723771808842,"duration":154},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"highly_available_cluster","time":{"start":1723771808843,"stop":1723772194013,"duration":385170},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1723771808843,"stop":1723771808843,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"continuous_writes","time":{"start":1723772194014,"stop":1723772196071,"duration":2057},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Stop server, write data, start and validate replication.","status":"broken","statusMessage":"KeyError: 'status'","statusTrace":"Traceback (most recent call last):\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: Optional[TResult] = func()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 262, in <lambda>\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 433, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 112, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 155, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 108, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 80, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 177, in pytest_runtest_call\n    raise e\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 169, in pytest_runtest_call\n    item.runtest()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1792, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 433, in __call__\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 112, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 155, in _multicall\n    return outcome.get_result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 108, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 80, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 194, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 532, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/high_availability/test_self_healing.py\", line 252, in test_replicate_data_on_restart\n    new_primary_unit = await get_primary_unit_wrapper(\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/helpers.py\", line 492, in get_primary_unit_wrapper\n    primary_unit = await get_primary_unit(ops_test, unit, app_name)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 88, in async_wrapped\n    return await fn(*args, **kwargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 47, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 325, in iter\n    raise retry_exc.reraise()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 158, in reraise\n    raise self.last_attempt.result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/tenacity/_asyncio.py\", line 50, in __call__\n    result = await fn(*args, **kwargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/helpers.py\", line 125, in get_primary_unit\n    for k, v in results[\"status\"][\"defaultreplicaset\"][\"topology\"].items():\nKeyError: 'status'","steps":[],"attachments":[{"uid":"43972a565695115c","name":"log","source":"43972a565695115c.txt","type":"text/plain","size":10346}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"continuous_writes::finalizer","time":{"start":1723772484119,"stop":1723772545395,"duration":61276},"status":"failed","statusMessage":"AssertionError\n","statusTrace":"  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/allure_commons/_allure.py\", line 221, in __call__\n    return self._fixture_function(*args, **kwargs)\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 302, in finalizer\n    event_loop.run_until_complete(async_finalizer())\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/runner/work/mysql-operator/mysql-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 294, in async_finalizer\n    await gen_obj.__anext__()\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/high_availability/conftest.py\", line 38, in continuous_writes\n    await juju_.run_action(application_unit, \"clear-continuous-writes\")\n  File \"/home/runner/work/mysql-operator/mysql-operator/tests/integration/juju_.py\", line 22, in run_action\n    assert result.results.get(\"return-code\") == 0\n","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"highly_available_cluster::finalizer","time":{"start":1723772545395,"stop":1723772545395,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail::0","time":{"start":1723772545396,"stop":1723772545396,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1723772545396,"stop":1723772553024,"duration":7628},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1723772553024,"stop":1723772553024,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1723772553024,"stop":1723772553024,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1723772553024,"stop":1723772553025,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"tag","value":"group(4)"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration.high_availability"},{"name":"suite","value":"test_self_healing"},{"name":"host","value":"fv-az1776-229"},{"name":"thread","value":"8653-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.high_availability.test_self_healing"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"6e2b4d2a2f6c95c6","status":"unknown","time":{}}],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":7,"broken":6,"skipped":6,"passed":60,"unknown":5,"total":84},"items":[{"uid":"ea05bd07ad08383b","reportUrl":"../2897//#testresult/ea05bd07ad08383b","status":"broken","statusDetails":"KeyError: 'status'","time":{"start":1723685745766,"stop":1723686034112,"duration":288346}},{"uid":"2ae7984a3a9e8166","reportUrl":"../2894//#testresult/2ae7984a3a9e8166","status":"broken","statusDetails":"KeyError: 'status'","time":{"start":1723600410491,"stop":1723600697306,"duration":286815}},{"uid":"e4d3a30e232d9380","reportUrl":"../2892//#testresult/e4d3a30e232d9380","status":"unknown","time":{}},{"uid":"506d13c35e8bc095","reportUrl":"../2883//#testresult/506d13c35e8bc095","status":"passed","time":{"start":1723427527267,"stop":1723427596763,"duration":69496}},{"uid":"6ad2e9e850fdafda","reportUrl":"../2882//#testresult/6ad2e9e850fdafda","status":"unknown","time":{}},{"uid":"2f836354b9f61af5","reportUrl":"../2881//#testresult/2f836354b9f61af5","status":"unknown","time":{}},{"uid":"fa093f7d8d39f4e3","reportUrl":"../2877//#testresult/fa093f7d8d39f4e3","status":"unknown","time":{}},{"uid":"bc1b77b82bc0429","reportUrl":"../2859//#testresult/bc1b77b82bc0429","status":"passed","time":{"start":1722908932958,"stop":1722909075578,"duration":142620}},{"uid":"2c2f1e7888105008","reportUrl":"../2850//#testresult/2c2f1e7888105008","status":"skipped","statusDetails":"XFAIL reason: aborted\n\n_pytest.outcomes.XFailed: aborted","time":{"start":1722824484175,"stop":1722824484175,"duration":0}},{"uid":"7cab4e5af18541c4","reportUrl":"../2849//#testresult/7cab4e5af18541c4","status":"skipped","statusDetails":"XFAIL reason: aborted\n\n_pytest.outcomes.XFailed: aborted","time":{"start":1722737068792,"stop":1722737068792,"duration":0}},{"uid":"80faf736261dc2c2","reportUrl":"../2848//#testresult/80faf736261dc2c2","status":"skipped","statusDetails":"XFAIL reason: aborted\n\n_pytest.outcomes.XFailed: aborted","time":{"start":1722650688064,"stop":1722650688064,"duration":0}},{"uid":"e32b646d3bac17a2","reportUrl":"../2841//#testresult/e32b646d3bac17a2","status":"skipped","statusDetails":"XFAIL reason: aborted\n\n_pytest.outcomes.XFailed: aborted","time":{"start":1722564081669,"stop":1722564081669,"duration":0}},{"uid":"5a7a4d5c1d38d3aa","reportUrl":"../2839//#testresult/5a7a4d5c1d38d3aa","status":"passed","time":{"start":1722476839233,"stop":1722476973018,"duration":133785}},{"uid":"e26ec62e9d7f2f74","reportUrl":"../2836//#testresult/e26ec62e9d7f2f74","status":"passed","time":{"start":1722390287166,"stop":1722390374215,"duration":87049}},{"uid":"c0615db5941e6de2","reportUrl":"../2832//#testresult/c0615db5941e6de2","status":"passed","time":{"start":1722304187226,"stop":1722304325238,"duration":138012}},{"uid":"ca9130c96dde9347","reportUrl":"../2827//#testresult/ca9130c96dde9347","status":"passed","time":{"start":1722217577454,"stop":1722217710697,"duration":133243}},{"uid":"3fa413ee3b121ed5","reportUrl":"../2824//#testresult/3fa413ee3b121ed5","status":"passed","time":{"start":1722131250784,"stop":1722131336064,"duration":85280}},{"uid":"4eaed695c6da2356","reportUrl":"../2819//#testresult/4eaed695c6da2356","status":"passed","time":{"start":1722044571807,"stop":1722044713844,"duration":142037}},{"uid":"811f56ef9463dc21","reportUrl":"../2811//#testresult/811f56ef9463dc21","status":"passed","time":{"start":1721958769026,"stop":1721958903727,"duration":134701}},{"uid":"29b75f320d8b857a","reportUrl":"../2807//#testresult/29b75f320d8b857a","status":"passed","time":{"start":1721872081537,"stop":1721872222754,"duration":141217}}]},"tags":["group(4)","asyncio","abort_on_fail"]},"source":"a1be80cb3d1c7e43.json","parameterValues":[]}